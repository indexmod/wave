<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Интерактивные топографические линии с деформацией, звуком и базовыми настройками изгиба, толщины, тона и пульсации.">
  <meta name="author" content="Introdex AI">
  <meta name="keywords" content="interactive, topographic, canvas, generative, sound, настройка, интерактив">
  <title>Interactive Topographic Lines — Controls + Sound</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; height: 100%; overflow: hidden; background-color: #000; font-family: sans-serif; }
    canvas { display: block; width: 100%; height: 100%; }
    .controls {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.7);
      padding: 12px 16px;
      border-radius: 8px;
      color: #00ffcc;
      font-size: 14px;
      z-index: 10;
    }
    .controls label {
      display: block;
      margin: 6px 0 2px;
    }
    .controls input[type=range] {
      width: 150px;
    }
  </style>
</head>
<body>

<div class="controls">
  <label>Изгиб линий: <span id="bendValue">10</span></label>
  <input type="range" id="bend" min="0" max="50" value="10">

  <label>Толщина линий: <span id="thicknessValue">1</span></label>
  <input type="range" id="thickness" min="1" max="5" value="1">

  <label>Тон звука: <span id="toneValue">200</span>Hz</label>
  <input type="range" id="tone" min="100" max="1000" value="200">

  <label>Пульс влияния: <span id="pulseValue">150</span></label>
  <input type="range" id="pulse" min="50" max="400" value="150">
</div>

<canvas id="topoCanvas"></canvas>

<script>
const canvas = document.getElementById('topoCanvas');
const ctx = canvas.getContext('2d');

let width = window.innerWidth;
let height = window.innerHeight;
canvas.width = width;
canvas.height = height;

// Настройки
let bendAmount = 10;
let lineThickness = 1;
let baseTone = 200;
let pulseRadius = 150;

let points = [];
const linesCount = 30;
let spacing = height / linesCount;

// Звуковой контекст
const AudioContext = window.AudioContext || window.webkitAudioContext;
const audioCtx = new AudioContext();

// Генерация линий
function generateLines() {
    points = [];
    spacing = height / linesCount;
    for (let i = 0; i < linesCount; i++) {
        let line = [];
        for (let x = 0; x <= width; x += 10) {
            let baseY = i * spacing + Math.sin(x * 0.01 + i) * bendAmount;
            line.push({x: x, y: baseY, baseY: baseY, offset: 0, lastTouched: 0});
        }
        points.push(line);
    }
}
generateLines();

let mouse = {x: width/2, y: height/2, isMoving: false};

// Обработка ресайза
window.addEventListener('resize', () => {
    width = window.innerWidth;
    height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;
    generateLines();
});

// Звук
function playTone(frequency = 440) {
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = 'sine';
    osc.frequency.setValueAtTime(frequency, audioCtx.currentTime);
    gain.gain.setValueAtTime(0.02, audioCtx.currentTime);
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + 0.1);
}

canvas.addEventListener('mousemove', (e) => {
    mouse.x = e.offsetX;
    mouse.y = e.offsetY;
    mouse.isMoving = true;
});
canvas.addEventListener('touchmove', (e) => {
    const rect = canvas.getBoundingClientRect();
    mouse.x = e.touches[0].clientX - rect.left;
    mouse.y = e.touches[0].clientY - rect.top;
    mouse.isMoving = true;
});
canvas.addEventListener('mouseleave', () => mouse.isMoving = false);
canvas.addEventListener('touchend', () => mouse.isMoving = false);

function draw() {
    ctx.clearRect(0, 0, width, height);
    ctx.lineWidth = lineThickness;
    ctx.strokeStyle = '#00ffcc';

    const now = performance.now();

    points.forEach(line => {
        ctx.beginPath();
        line.forEach((p, i) => {
            let dx = p.x - mouse.x;
            let dy = p.baseY - mouse.y;
            let dist = Math.sqrt(dx*dx + dy*dy);
            let influence = Math.max(pulseRadius - dist, 0) * 0.15;

            if (mouse.isMoving && influence > 0.5) {
                if (now - p.lastTouched > 100) {
                    const freq = baseTone + (p.baseY / height) * 600;
                    playTone(freq);
                    p.lastTouched = now;
                }
                p.offset = influence * Math.sin(dist * 0.05);
            }

            p.offset *= 0.9;

            let ny = p.baseY + p.offset;

            if (i === 0) {
                ctx.moveTo(p.x, ny);
            } else {
                ctx.lineTo(p.x, ny);
            }
        });
        ctx.stroke();
    });

    requestAnimationFrame(draw);
}

draw();

// Слайдеры
const bendSlider = document.getElementById('bend');
const thicknessSlider = document.getElementById('thickness');
const toneSlider = document.getElementById('tone');
const pulseSlider = document.getElementById('pulse');

bendSlider.addEventListener('input', () => {
    bendAmount = parseInt(bendSlider.value);
    document.getElementById('bendValue').innerText = bendAmount;
    generateLines();
});
thicknessSlider.addEventListener('input', () => {
    lineThickness = parseInt(thicknessSlider.value);
    document.getElementById('thicknessValue').innerText = lineThickness;
});
toneSlider.addEventListener('input', () => {
    baseTone = parseInt(toneSlider.value);
    document.getElementById('toneValue').innerText = baseTone;
});
pulseSlider.addEventListener('input', () => {
    pulseRadius = parseInt(pulseSlider.value);
    document.getElementById('pulseValue').innerText = pulseRadius;
});
</script>

</body>
</html>
